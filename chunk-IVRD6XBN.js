import{a as u,f as Q,h as Y,i as Z}from"./chunk-H44H3TE7.js";import{a as S,m as g,n as y,o as K}from"./chunk-S23KONLI.js";import{d as X}from"./chunk-UTXMMGXG.js";import{$b as E,Ac as z,Ba as c,Ea as T,Jc as H,Ka as O,Na as w,Nb as P,Pc as J,Wa as D,Yb as A,Zb as R,_b as L,ab as x,ac as j,bb as o,bc as W,cb as a,cc as B,dc as F,ec as G,fc as U,ga as f,gc as V,hb as M,ib as h,jb as m,kb as p,la as _,ma as C,pa as $,pb as N,qb as s,sb as k,tb as b,zc as q}from"./chunk-E7ADILNX.js";var v=K("categoriesState"),se=y(v,r=>r?.categories??[]),ee=y(v,r=>r?.spendingCategories??[]),te=y(v,r=>r?.assetsCategories??[]),ce=y(v,r=>r?.isLoading??!1);function ne(r,l){if(r&1){let i=h();o(0,"mat-tree-node",6),s(1),o(2,"button",7),m("click",function(){let n=_(i).$implicit,t=p();return C(t.onCreateSubCategory(n))}),o(3,"mat-icon"),s(4,"add"),a()(),o(5,"button",7),m("click",function(){let n=_(i).$implicit,t=p();return C(t.openDeleteConfirmationDialog(n))}),o(6,"mat-icon"),s(7,"delete"),a()()()}if(r&2){let i=l.$implicit;c(),b(" ",i.name," ",i.currencyCode," ")}}function ie(r,l){if(r&1){let i=h();o(0,"mat-nested-tree-node")(1,"div",8)(2,"button",9)(3,"mat-icon",10),s(4),a()(),s(5),o(6,"button",7),m("click",function(){let n=_(i).$implicit,t=p();return C(t.onCreateSubCategory(n))}),o(7,"mat-icon"),s(8,"add"),a()(),o(9,"button",7),m("click",function(){let n=_(i).$implicit,t=p();return C(t.openDeleteConfirmationDialog(n))}),o(10,"mat-icon"),s(11,"delete"),a()()(),o(12,"div",11),M(13,12),a()()}if(r&2){let i=l.$implicit,e=p();c(2),D("aria-label","Toggle "+i.name),c(2),k(" ",e.spendingTreeControl.isExpanded(i)?"expand_more":"chevron_right"," "),c(),b(" ",i.name," ",i.currencyCode," "),c(7),N("example-tree-invisible",!e.spendingTreeControl.isExpanded(i))}}function oe(r,l){if(r&1){let i=h();o(0,"mat-tree-node",6),s(1),o(2,"button",7),m("click",function(){let n=_(i).$implicit,t=p();return C(t.onCreateSubCategory(n))}),o(3,"mat-icon"),s(4,"add"),a()(),o(5,"button",7),m("click",function(){let n=_(i).$implicit,t=p();return C(t.openDeleteConfirmationDialog(n))}),o(6,"mat-icon"),s(7,"delete"),a()()()}if(r&2){let i=l.$implicit;c(),b(" ",i.name," ",i.currencyCode," ")}}function re(r,l){if(r&1){let i=h();o(0,"mat-nested-tree-node")(1,"div",8)(2,"button",9)(3,"mat-icon",10),s(4),a()(),s(5),o(6,"button",7),m("click",function(){let n=_(i).$implicit,t=p();return C(t.onCreateSubCategory(n))}),o(7,"mat-icon"),s(8,"add"),a()(),o(9,"button",7),m("click",function(){let n=_(i).$implicit,t=p();return C(t.openDeleteConfirmationDialog(n))}),o(10,"mat-icon"),s(11,"delete"),a()()(),o(12,"div",11),M(13,12),a()()}if(r&2){let i=l.$implicit,e=p();c(2),D("aria-label","Toggle "+i.name),c(2),k(" ",e.assetsTreeControl.isExpanded(i)?"expand_more":"chevron_right"," "),c(),b(" ",i.name," ",i.currencyCode," "),c(7),N("example-tree-invisible",!e.assetsTreeControl.isExpanded(i))}}var Ve=(()=>{let l=class l{constructor(e,n,t){this.store=e,this.categoriesService=n,this.dialog=t,this.spendingTreeControl=new E(d=>d.children),this.spendingDataSource=new V,this.assetsTreeControl=new E(d=>d.children),this.assetsDataSource=new V,this.spendingCategories$=f(g).select(ee),this.assetsCategories$=f(g).select(te),this.defaultCurrency$=f(g).select(Y),this.destroyRef=f($),this.hasChild=(d,I)=>!!I.children&&I.children.length>0,this.spendingCategories$.pipe(S(this.destroyRef)).subscribe(d=>{this.spendingDataSource.data=d,this.expandAllNodes(this.spendingTreeControl,d)}),this.assetsCategories$.pipe(S(this.destroyRef)).subscribe(d=>{this.assetsDataSource.data=d,this.expandAllNodes(this.assetsTreeControl,d)})}ngOnInit(){this.store.dispatch(u())}onCreateTopLevelSpendingCategory(){this.defaultCurrency$.pipe(S(this.destroyRef)).subscribe(e=>{let n={parentId:void 0,type:0,name:"New Top Level Spending",currencyCode:e,iconId:void 0};this.categoriesService.createCategory(n).subscribe(()=>{this.store.dispatch(u())})})}onCreateTopLevelAssetCategory(){this.defaultCurrency$.pipe(S(this.destroyRef)).subscribe(e=>{let n={parentId:void 0,type:1,name:"New Top Level Asset",currencyCode:e,iconId:void 0};this.categoriesService.createCategory(n).subscribe(()=>{this.store.dispatch(u())})})}onCreateSubCategory(e){let n={parentId:e.id,type:e.type,name:"New Subcategory",currencyCode:e.currencyCode,iconId:void 0};this.categoriesService.createCategory(n).subscribe(()=>{this.store.dispatch(u())})}onDeleteCategory(e){this.categoriesService.deleteCategory(e.id).subscribe(()=>{this.store.dispatch(u())})}openDeleteConfirmationDialog(e){this.dialog.open(Z,{width:"250px",data:{name:e.name}}).afterClosed().subscribe(t=>{t&&this.onDeleteCategory(e)})}expandAllNodes(e,n){n.forEach(t=>{e.expand(t),t.children&&this.expandAllNodes(e,t.children)})}};l.\u0275fac=function(n){return new(n||l)(T(g),T(Q),T(H))},l.\u0275cmp=O({type:l,selectors:[["app-categories"]],decls:13,vars:6,consts:[["label","Spending"],["mat-raised-button","","color","primary",3,"click"],[1,"example-tree",3,"dataSource","treeControl"],["matTreeNodeToggle","",4,"matTreeNodeDef"],[4,"matTreeNodeDef","matTreeNodeDefWhen"],["label","Assets"],["matTreeNodeToggle",""],["mat-icon-button","",3,"click"],[1,"mat-tree-node"],["mat-icon-button","","matTreeNodeToggle",""],[1,"mat-icon-rtl-mirror"],["role","group"],["matTreeNodeOutlet",""]],template:function(n,t){n&1&&(o(0,"mat-tab-group")(1,"mat-tab",0)(2,"button",1),m("click",function(){return t.onCreateTopLevelSpendingCategory()}),s(3,"New Spending Category"),a(),o(4,"mat-tree",2),w(5,ne,8,2,"mat-tree-node",3)(6,ie,14,6,"mat-nested-tree-node",4),a()(),o(7,"mat-tab",5)(8,"button",1),m("click",function(){return t.onCreateTopLevelAssetCategory()}),s(9,"New Asset Category"),a(),o(10,"mat-tree",2),w(11,oe,8,2,"mat-tree-node",3)(12,re,14,6,"mat-nested-tree-node",4),a()()()),n&2&&(c(4),x("dataSource",t.spendingDataSource)("treeControl",t.spendingTreeControl),c(2),x("matTreeNodeDefWhen",t.hasChild),c(4),x("dataSource",t.assetsDataSource)("treeControl",t.assetsTreeControl),c(2),x("matTreeNodeDefWhen",t.hasChild))},dependencies:[P,J,A,R,L,B,W,U,G,j,F,z,q,X],styles:[".mat-tree[_ngcontent-%COMP%]{background-color:var(--mat-sidenav-content-background-color)}.example-tree-invisible[_ngcontent-%COMP%]{display:none}.example-tree[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%], .example-tree[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0;list-style-type:none}.example-tree[_ngcontent-%COMP%]   .mat-nested-tree-node[_ngcontent-%COMP%]   div[role=group][_ngcontent-%COMP%]{padding-left:40px}.example-tree[_ngcontent-%COMP%]   div[role=group][_ngcontent-%COMP%] > .mat-tree-node[_ngcontent-%COMP%]{padding-left:40px}[_nghost-%COMP%]     .mat-mdc-tab-body-content{overflow:hidden!important}"]});let r=l;return r})();export{Ve as CategoriesComponent};
